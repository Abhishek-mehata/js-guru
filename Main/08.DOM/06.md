# Async and Defer in JavaScript

## Overview

This guide explains the different ways to load JavaScript files in HTML and how `async` and `defer` attributes solve common performance issues.

## The Problem with Traditional Script Loading

### Method 1: Script in `<head>` (Not Recommended)

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="script.js"></script>
    <!--1st way to implement JS in html-->
    <!-- Here after loading meta tags and title, browser will
     start loading js and till this time any content inside body is
     not loaded which makes user to loose intrest from our site
     TO solve this problem we generally put <script> at the end
     of body tag
     -->
  </head>
  <body>
    <!-- Content loads AFTER JavaScript finishes loading -->
  </body>
</html>
```

**Issue**: Browser loads JavaScript before any body content, causing delays and poor user experience.

### Method 2: Script at End of `<body>` (Better, but not perfect)

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- HTML content loads first -->
    
    <!-- 2nd way to add JS in HTML -->
    <script src="script.js"></script>
    <!-- this second method lets body content to load and then
     it starts loading script.
     But there is also a problem if the js file is too long as it takes lot time to load,
     html is loaded but when user clicks on button or dynamic area and when js is not loaded
      then the page will act like static and user intrest will be loosed -->

    <!-- when user clicks a button and if it is not responding then user will loose intrest to use the website, (user will think that 
     there is website issue or internet issue or some thing else) -->
  </body>
</html>
```

**Issue**: HTML loads first, but if JavaScript takes too long to load, interactive elements won't work, leading to poor user experience.

## The Solution: `defer` and `async` Attributes

To solve these problems, `async` and `defer` attributes come into the picture.

## `defer` Attribute

### How `defer` Works

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script defer src="script.js"></script>
    <!-- 
    IN 'defer' browser will start loading html and parallely it will also start downloading the script and
    once the entire html is printed in browser then only it will start executing JS code
    -->
  </head>
  <body>
    <!-- HTML content loads while JavaScript downloads in parallel -->
  </body>
</html>
```

### Multiple `defer` Scripts

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script defer src="script1.js"></script>
    <script defer src="script2.js"></script>
    <script defer src="script3.js"></script>
    <!-- this will also act same at first it will load first script and then second script and then again third script parallely downloading while printing html content in webpage.
        and once all the scripts are loaded then it will start executing all JS files one by one in order
    -->
  </head>
  <body>
    <!-- HTML content -->
  </body>
</html>
```

**Key Points about `defer`:**
- Scripts download in parallel with HTML parsing
- Scripts execute **after** HTML parsing is complete
- Multiple defer scripts execute in the **order they appear** in the HTML
- Perfect for scripts that need the full DOM to be ready

## `async` Attribute

### How `async` Works

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script async src="script.js"></script>
    <!-- async will also start downloading the Scripts while parallely parsing the HTML content -->
    <!-- but the moment when entire JS file is downloaded it will start executing the JS file without waiting for all html content to be parsed -->
    <!-- this is the key difference between async and defer -->
  </head>
  <body>
    <!-- HTML content -->
  </body>
</html>
```

### Multiple `async` Scripts

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- What if there are multiple files -->
    <script async src="script2.js"></script>
    <script async src="script1.js"></script>
    <script async src="script3.js"></script>
    <!-- When there are multiple js files, whichever downloads first will start executing without taking care of whether whole html content is parsed and other files are also downloaded or not -->
  </head>
  <body>
    <!-- HTML content -->
  </body>
</html>
```

**Key Points about `async`:**
- Scripts download in parallel with HTML parsing
- Scripts execute **immediately** when download completes
- Multiple async scripts execute in **download order** (not DOM order)
- Can interrupt HTML parsing during execution
- Perfect for independent scripts (analytics, ads, etc.)

## Comparison Table

| Attribute | Download | Execution | HTML Parsing | Script Order | Use Case |
|-----------|----------|-----------|--------------|--------------|----------|
| None (head) | Blocks HTML | Immediate | Blocked | In order | ❌ Not recommended |
| None (body end) | After HTML | Immediate | Complete | In order | ✅ Basic approach |
| `defer` | Parallel | After HTML complete | Continues | Maintained | ✅ DOM-dependent scripts |
| `async` | Parallel | When ready | May be interrupted | Download order | ✅ Independent scripts |

## Best Practices

### Use `defer` when:
- Script depends on the full DOM being ready
- Script order matters
- Scripts interact with each other
- Most application scripts

### Use `async` when:
- Script is independent (analytics, ads)
- Script doesn't depend on DOM elements
- Script order doesn't matter
- Third-party scripts

### Example of Combined Usage

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    
    <!-- Independent third-party scripts -->
    <script async src="analytics.js"></script>
    <script async src="ads.js"></script>
    
    <!-- Application scripts that need DOM and order -->
    <script defer src="utils.js"></script>
    <script defer src="main.js"></script>
    <script defer src="app.js"></script>
  </head>
  <body>
    <!-- Your HTML content -->
  </body>
</html>
```

## Summary

Using `async` and `defer` attributes optimizes page loading performance by allowing JavaScript to download in parallel with HTML parsing, preventing the blocking behavior that leads to poor user experience. Choose the right attribute based on your script's dependencies and execution requirements.